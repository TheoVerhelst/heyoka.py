
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The variational equations &#8212; heyoka.py 0.6.0 documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Long term stability of N-body simulations: the case of Trappist-1" href="Long%20term%20stability%20of%20Trappist-1.html" />
    <link rel="prev" title="The restricted three-body problem" href="The%20restricted%20three-body%20problem.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/white_logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">heyoka.py 0.6.0 documentation</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Contents
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../install.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../basic_tutorials.html">
   Basic tutorials
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../tut_taylor_method.html">
     Taylor’s method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="The%20expression%20system.html">
     The expression system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="The%20adaptive%20integrator.html">
     The adaptive integrator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Customising%20the%20adaptive%20integrator.html">
     Customising the adaptive integrator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ODEs%20with%20parameters.html">
     ODEs with parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Non-autonomous%20systems.html">
     Non-autonomous systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Dense%20output.html">
     Dense output
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Event%20detection.html">
     Event detection
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="../advanced_tutorials.html">
   Advanced tutorials
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="The%20restricted%20three-body%20problem.html">
     The restricted three-body problem
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     The variational equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Long%20term%20stability%20of%20Trappist-1.html">
     Long term stability of N-body simulations: the case of Trappist-1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Poincar%C3%A9%20sections.html">
     Poincaré sections
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="The%20Keplerian%20billiard.html">
     The Keplerian billiard
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Sampling%20events.html">
     Sampling events
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="The%20two-fixed%20elliptic%20billiard.html">
     The two-fixed centres elliptic billiard
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../changelog.html">
   Changelog
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/The variational equations.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/bluescarni/heyoka.py"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/bluescarni/heyoka.py/issues/new?title=Issue%20on%20page%20%2Fnotebooks/The variational equations.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/bluescarni/heyoka.py/main?urlpath=tree/doc/notebooks/The variational equations.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="the-variational-equations">
<h1>The variational equations<a class="headerlink" href="#the-variational-equations" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will show how it is possible to exploit heyoka.py’s expression system to implement first-order variational equations for a system of ODEs.</p>
<p>First, let’s start with a brief recap on the variational equations. For simplicity, we will consider an autonomous ODE system in the variables <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> (the extension to more variables just complicates the notation):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{cases}
\frac{dx}{dt} = f\left(x, y \right)\\
\frac{dy}{dt} = g\left(x, y \right)
\end{cases},
\end{split}\]</div>
<p>with initial conditions</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{cases}
x\left( 0 \right) = x_0\\
y\left( 0 \right) = y_0
\end{cases}.
\end{split}\]</div>
<p>The solutions of this ODE system will be the functions <span class="math notranslate nohighlight">\(x\left( t; x_0, y_0 \right)\)</span> and <span class="math notranslate nohighlight">\(y\left( t; x_0, y_0 \right)\)</span>. Our objective is to determine the evolution in time of the first-order derivatives of these solutions with respect to the initial conditions <span class="math notranslate nohighlight">\(\left( x_0, y_0 \right)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\left(\frac{\partial x}{\partial x_0}\right)\left(t; x_0, y_0\right),\\
\left(\frac{\partial x}{\partial y_0}\right)\left(t; x_0, y_0\right),\\
\left(\frac{\partial y}{\partial x_0}\right)\left(t; x_0, y_0\right),\\
\left(\frac{\partial y}{\partial y_0}\right)\left(t; x_0, y_0\right).\\
\end{aligned}
\end{split}\]</div>
<p>These functions tell us how the the solutions of the ODE system react to changes in the initial values <span class="math notranslate nohighlight">\(\left( x_0, y_0 \right)\)</span>. One way of determining numerically the evolution in time of the partial derivatives is to introduce them as additional state variables in the original ODE system, together with an additional set of differential equations (i.e., the variational equations). Let’s see how this is done for, e.g., <span class="math notranslate nohighlight">\(\frac{\partial x}{\partial x_0}\)</span>. We take the time derivative of <span class="math notranslate nohighlight">\(\frac{\partial x}{\partial x_0}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{d \left( \frac{\partial x}{\partial x_0} \right)}{dt},
\]</div>
<p>and expand it, via elementary calculus rules, to</p>
<div class="math notranslate nohighlight">
\[
\frac{d \left( \frac{\partial x}{\partial x_0} \right)}{dt} = \frac{\partial \left( \frac{dx}{dt} \right) }{\partial x_0}=\frac{\partial f\left(x, y\right)}{\partial x}\frac{\partial x}{\partial x_0}+\frac{\partial f \left(x, y\right)}{\partial y}\frac{\partial y}{\partial x_0}.
\]</div>
<p>We can write similar ODEs for the other partial derivatives, append them below the original ODE system and finally obtain an augmented ODE system containing the variational equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{cases}
\frac{dx}{dt} = f\left(x, y \right)\\
\frac{dy}{dt} = g\left(x, y \right)\\
\frac{d \left( \frac{\partial x}{\partial x_0} \right)}{dt} = \frac{\partial f\left(x, y\right)}{\partial x}\frac{\partial x}{\partial x_0}+\frac{\partial f\left(x, y\right)}{\partial y}\frac{\partial y}{\partial x_0}\\
\frac{d \left( \frac{\partial x}{\partial y_0} \right)}{dt} = \frac{\partial f\left(x, y\right)}{\partial x}\frac{\partial x}{\partial y_0}+\frac{\partial f\left(x, y\right)}{\partial y}\frac{\partial y}{\partial y_0}\\
\frac{d \left( \frac{\partial y}{\partial x_0} \right)}{dt} = \frac{\partial g\left(x, y\right)}{\partial x}\frac{\partial x}{\partial x_0}+\frac{\partial g\left(x, y\right)}{\partial y}\frac{\partial y}{\partial x_0}\\
\frac{d \left( \frac{\partial y}{\partial y_0} \right)}{dt} = \frac{\partial g\left(x, y\right)}{\partial x}\frac{\partial x}{\partial y_0}+\frac{\partial g\left(x, y\right)}{\partial y}\frac{\partial y}{\partial y_0}
\end{cases}.
\end{split}\]</div>
<p>The introduction of the variational equations in an ODE system of <span class="math notranslate nohighlight">\(n\)</span> equations results in additional <span class="math notranslate nohighlight">\(n^2\)</span> equations and variables. The initial conditions for the new variables are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{cases}
\frac{\partial x}{\partial x_0} \left( 0 \right) = 1\\
\frac{\partial x}{\partial y_0} \left( 0 \right) = 0\\
\frac{\partial y}{\partial x_0} \left( 0 \right) = 0\\
\frac{\partial y}{\partial y_0} \left( 0 \right) = 1\\
\end{cases}.
\end{split}\]</div>
<p>Let us now try to implement the variational equations for the simple pendulum:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">heyoka</span> <span class="k">as</span> <span class="nn">hy</span>

<span class="c1"># Create the state variables x and v.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">hy</span><span class="o">.</span><span class="n">make_vars</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">)</span>

<span class="c1"># Create the symbolic variables for the variational equations.</span>
<span class="n">x_x0</span><span class="p">,</span> <span class="n">x_y0</span><span class="p">,</span> <span class="n">y_x0</span><span class="p">,</span> <span class="n">y_y0</span> <span class="o">=</span> <span class="n">hy</span><span class="o">.</span><span class="n">make_vars</span><span class="p">(</span><span class="s2">&quot;x_x0&quot;</span><span class="p">,</span> <span class="s2">&quot;x_y0&quot;</span><span class="p">,</span> <span class="s2">&quot;y_x0&quot;</span><span class="p">,</span> <span class="s2">&quot;y_y0&quot;</span><span class="p">)</span>

<span class="c1"># Create the right-hand side of the ODE system.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">v</span>
<span class="n">g</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.8</span> <span class="o">*</span> <span class="n">hy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x_x0_p</span> <span class="o">=</span> <span class="n">hy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_x0</span> <span class="o">+</span> <span class="n">hy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_x0</span>
<span class="n">x_y0_p</span> <span class="o">=</span> <span class="n">hy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_y0</span> <span class="o">+</span> <span class="n">hy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_y0</span>
<span class="n">y_x0_p</span> <span class="o">=</span> <span class="n">hy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_x0</span> <span class="o">+</span> <span class="n">hy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_x0</span>
<span class="n">y_y0_p</span> <span class="o">=</span> <span class="n">hy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_y0</span> <span class="o">+</span> <span class="n">hy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_y0</span>

<span class="c1"># Create the integrator object.</span>
<span class="n">ta</span> <span class="o">=</span> <span class="n">hy</span><span class="o">.</span><span class="n">taylor_adaptive</span><span class="p">(</span>
                        <span class="c1"># Definition of the ODE system.</span>
                        <span class="n">sys</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">x_x0</span><span class="p">,</span> <span class="n">x_x0_p</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">x_y0</span><span class="p">,</span> <span class="n">x_y0_p</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">y_x0</span><span class="p">,</span> <span class="n">y_x0_p</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">y_y0</span><span class="p">,</span> <span class="n">y_y0_p</span><span class="p">),</span>
                        <span class="p">],</span>
                        <span class="c1"># Initial conditions.</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">ta</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Taylor order            : 20
Dimension               : 6
Time                    : 0.0000000000000000
State                   : [0.050000000000000003, 0.025000000000000001, 1.0000000000000000, 0.0000000000000000, 0.0000000000000000, 1.0000000000000000]
</pre></div>
</div>
</div>
</div>
<p>Here we used the <code class="docutils literal notranslate"><span class="pre">diff()</span></code> function to perform the symbolic differentiation of <code class="docutils literal notranslate"><span class="pre">f</span></code> and <code class="docutils literal notranslate"><span class="pre">g</span></code> with respect to the state variables.</p>
<p>Let us now propagate the state of the system (including the variational equations) up to <span class="math notranslate nohighlight">\(t=50\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ta</span><span class="o">.</span><span class="n">propagate_until</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ta</span><span class="o">.</span><span class="n">state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.03744787,  0.10667026,  0.80315068, -0.17679098,  1.82916222,
        0.84245788])
</pre></div>
</div>
</div>
</div>
<p>Next, we are going to create another integrator for the simple pendulum, this time <em>without</em> the variational equations and perturbing the initial value of <span class="math notranslate nohighlight">\(x\)</span> by <span class="math notranslate nohighlight">\(10^{-8}\)</span> with respect to the original initial conditions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ta_dx</span> <span class="o">=</span> <span class="n">hy</span><span class="o">.</span><span class="n">taylor_adaptive</span><span class="p">(</span>
                        <span class="c1"># Definition of the ODE system.</span>
                        <span class="n">sys</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
                        <span class="p">],</span>
                        <span class="c1"># Initial conditions.</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">])</span>

<span class="n">ta_dx</span><span class="o">.</span><span class="n">propagate_until</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;taylor_outcome.time_limit: -4294967299&gt;,
 0.20208180443700685,
 0.2182277296610072,
 240)
</pre></div>
</div>
</div>
</div>
<p>Because of the perturbation on the initial value of <span class="math notranslate nohighlight">\(x\)</span>, the value of <span class="math notranslate nohighlight">\(x\)</span> at <span class="math notranslate nohighlight">\(t=50\)</span> will differ in the two integrators:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ta</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ta_dx</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-8.03149771688716e-09
</pre></div>
</div>
</div>
</div>
<p>However, because in the variational integrator we now have the value of <span class="math notranslate nohighlight">\(\frac{\partial x}{\partial x_0}\)</span> at <span class="math notranslate nohighlight">\(t=50\)</span>, we can compute an approximation of the <span class="math notranslate nohighlight">\(\Delta x\)</span> induced by the perturbation on the initial state as</p>
<div class="math notranslate nohighlight">
\[
\Delta x \approx \frac{\partial x}{\partial x_0}\left( 50 \right) \cdot 10^{-8}.
\]</div>
<p>Indeed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ta</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-8</span><span class="p">)</span> <span class="o">-</span> <span class="n">ta_dx</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.089951014118469e-15
</pre></div>
</div>
</div>
</div>
</div>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="The%20restricted%20three-body%20problem.html" title="previous page">The restricted three-body problem</a>
    <a class='right-next' id="next-link" href="Long%20term%20stability%20of%20Trappist-1.html" title="next page">Long term stability of N-body simulations: the case of Trappist-1</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Francesco Biscani and Dario Izzo<br/>
        
            &copy; Copyright 2020, 2021, Francesco Biscani and Dario Izzo.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>